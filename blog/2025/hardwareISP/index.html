<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Raspberry Pi Pico as a hardware ISP | Jason Rinehart's Portfolio </title> <meta name="author" content="Jason R. Rinehart"> <meta name="description" content="A collection of projects and blog posts about electronics and computers. "> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%9A%A9&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://rinehartj.github.io/blog/2025/hardwareISP/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Raspberry Pi Pico as a hardware ISP",
            "description": "",
            "published": "February 23, 2025",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Jason Rinehart's Portfolio </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Raspberry Pi Pico as a hardware ISP</h1> <p></p> </d-title> <d-article> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/hardwareISP/isp-480.webp 480w,/assets/img/hardwareISP/isp-800.webp 800w,/assets/img/hardwareISP/isp-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/hardwareISP/isp.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <h4 id="this-project-began-when-i-was-looking-for-proof-that-my-arduino-nano-could-be-brought-back-to-life">This project began when I was looking for proof that my Arduino Nano could be brought back to life.</h4> <h2 id="introduction">Introduction</h2> <p>Why purchase the genuine version of an open source hardware device when clones can be purchased for less? I asked myself this question a few years ago and decided to pick up some Arduino Nano clones from AliExpress. Once they arrived, I remember them to be well-soldered and free of noticeable imperfections. As I experimented with the boards, I learned the quirks of these specific boards thoroughly.</p> <h2 id="terms">Terms</h2> <p>The term “<strong>open source</strong>” describes source code or design documents that are free to access and redistribute<d-cite key="enwiki:1276146904"></d-cite>. <strong>Arduino</strong> is an open source platform and community centered around making complex electronics and digital technologies available to all<d-cite key="arduinoAboutArduino"></d-cite>. The Arduino Integrated Development Environment (IDE) is a software for writing code and programming Arduino boards, including the Arduino Nano. This article mentions the Arduino Nano, a compact microcontroller board that hosts the ATMega328P microcontroller.</p> <h2 id="findings">Findings</h2> <p>At first, code was not uploading to any of the Arduino Nano boards. The Arduino IDE would get stuck on “Uploading…” or similar. Thankfully, communication issues between the board and software are thoroughly documented online. I found that two changes were important to getting my version of the Nano clone working:</p> <p>First, the <code class="language-plaintext highlighter-rouge">CH340G</code> USB to UART converter chip on the clones required downloading and installing a driver. The name of the file was <code class="language-plaintext highlighter-rouge">CH341SER.exe</code> which can be downloaded <a href="http://www.wch.cn/download/CH341SER_EXE.html" rel="external nofollow noopener" target="_blank">here</a>.</p> <p>Furthermore, I needed to make the following setting in Arduino IDE:</p> <ul> <li>Processor: <strong>ATMega328P (Old Bootloader)</strong> </li> </ul> <p>There appears to be two bootloaders for the <code class="language-plaintext highlighter-rouge">ATMega328P</code> chip, titled by Arduino IDE as “old” and “new”. My Nano only worked when setting the Arduino IDE to “Old Bootloader” so I assume it had the old bootloader installed. Later in this article, I discuss how I flashed the “new” bootloader to the chip using a Raspberry Pi Pico microcontroller board.</p> <p>Finally, I made sure to use a USB cable that supported <strong>data and power</strong> (as opposed to <strong>power only</strong>). I did this by listening for the USB insertion sound when I plugged in the cable and checking the device manager utility for a new listing.</p> <h2 id="how-i-accidentally-erased-the-bootloader">How I accidentally erased the bootloader</h2> <div class="row mt-3"> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/hardwareISP/MarlinOldFirmware-480.webp 480w,/assets/img/hardwareISP/MarlinOldFirmware-800.webp 800w,/assets/img/hardwareISP/MarlinOldFirmware-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/hardwareISP/MarlinOldFirmware.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/hardwareISP/MarlinNewFirmware-480.webp 480w,/assets/img/hardwareISP/MarlinNewFirmware-800.webp 800w,/assets/img/hardwareISP/MarlinNewFirmware-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/hardwareISP/MarlinNewFirmware.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-8 mt-3 mt-md-0"> Earlier this year, I updated the firmware for my Ender 3 Pro 3D printer to access a new feature called "Z-Babystep". However, on older Ender 3 Pro versions using the 8-bit "Melzi" motherboard, bootloaders were sometimes not included from the factory, including mine. I flashed a bootloader myself using <a href="https://letsprint3d.net/guide-how-to-flash-a-bootloader-on-melzi-boards/" rel="external nofollow noopener" target="_blank">this online guide</a>. After wiring the SPI headers of my Arduino Nano and Melzi motherboard together, I uploaded the "Arduino as ISP" sketch to the Nano using Arduino IDE. Then, I set "Board" to "Sanguino" and used the "Burn Bootloader" function. At this point, I was able to upload Marlin firmware without issue. </div> </div> <p>However, this process seemed to have wiped the bootloader from my Arduino Nano, as it was no longer accepting new sketches. Arduino IDE was hanging at “Uploading Sketch”.</p> <h2 id="flashing-the-new-bootloader">Flashing the new bootloader</h2> <p>To flash an ATMega chip with a corrupted or erased bootloader such as mine, an <strong>In-System Programmer</strong> (ISP) is needed. The easiest path forward would be to use <em>another Arduino</em> since both devices would operate at the same logic level (5V). I had none on hand so I chose to use a Raspberry Pi Pico which operates at 3.3V. I needed to be careful that logic levels would not saturate.</p> <p>According to the datasheet, the maximum safe DIO voltage of the RP2040 is <code class="language-plaintext highlighter-rouge">IOVDD + 0.5V</code>. I measured the IOVDD pin using a multimeter and found it to be 3.27V, so in my case, the maximum safe DIO voltage was 3.77V. It was possible that level shifters were not needed between the Arduino Nano and Pi Pico, as long as the Arduino Nano could operate at 3.77V reliably.</p> <h3 id="flashing-steps">Flashing Steps</h3> <ol> <li>I downloaded the Adafruit AVR programmer repository <a href="https://github.com/adafruit/Adafruit_CircuitPython_AVRprog/tree/main" rel="external nofollow noopener" target="_blank">here</a>.</li> <li>I held the <code class="language-plaintext highlighter-rouge">BOOTSEL</code> button on the Pi Pico while plugging it in over a data-capable USB cable. I then let go of the button and uploaded the <a href="https://circuitpython.org/board/raspberry_pi_pico/" rel="external nofollow noopener" target="_blank">CircuitPython .uf2 file</a> to the mounted drive.</li> <li>I connected to the Pi Pico using the online CircuitPython IDE available <a href="https://code.circuitpython.org/" rel="external nofollow noopener" target="_blank">here</a> to upload code and libraries.</li> </ol> <p>When all was finished, the file structure of the Pi Pico root directory looked like this:</p> <div class="col-sm mt-3 mt-md-0 w-50"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/hardwareISP/filesystem-480.webp 480w,/assets/img/hardwareISP/filesystem-800.webp 800w,/assets/img/hardwareISP/filesystem-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/hardwareISP/filesystem.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>I then made the following connections between the Arduino Nano and Pi Pico:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Arduino Clk &lt;&gt; Pico GP18
Arduino MOSI &lt;&gt; Pico GP19
Arduino MISO &lt;&gt; Pico GP16
Arduino RST &lt;&gt; Pico GP10
</code></pre></div></div> <p>and set these accordingly in Code.py as seen below:</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spi</span> <span class="o">=</span> <span class="n">busio</span><span class="p">.</span><span class="nc">SPI</span><span class="p">(</span><span class="n">clock</span><span class="o">=</span><span class="n">board</span><span class="p">.</span><span class="n">GP18</span><span class="p">,</span> <span class="n">MOSI</span><span class="o">=</span><span class="n">board</span><span class="p">.</span><span class="n">GP19</span><span class="p">,</span> <span class="n">MISO</span><span class="o">=</span><span class="n">board</span><span class="p">.</span><span class="n">GP16</span><span class="p">)</span>
<span class="n">avrprog</span> <span class="o">=</span> <span class="n">adafruit_avrprog</span><span class="p">.</span><span class="nc">AVRprog</span><span class="p">()</span>
<span class="n">avrprog</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">spi</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">GP10</span><span class="p">)</span>
</code></pre></div></div> <p>I ran the code, and to my surprise the chip was flashed in less than a second. At first I was worried, because the program skipped almost all of the sectors. However, at the very end, code was uploaded and verified, which I presume to be the bootloader. After a round of testing, the Arduino was then able to accept code via the Arduino IDE. Since I flashed the <em>new</em> bootloader, I could now select <code class="language-plaintext highlighter-rouge">Processor: ATmega328P</code> instead of the old bootloader option.</p> <details><summary>Click to expand console output</summary> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ready to GO, type 'G' here to start&gt; G
Found signature: ['0x1e', '0x95', '0xf']
Found ATmega328p
Programming flash from file
Erasing chip....
Programming page $0000...skipping
Programming page $0080...skipping
Programming page $0100...skipping
Programming page $0180...skipping
Programming page $0200...skipping
Programming page $0280...skipping

(230 more lines...)

Programming page $7880...skipping
Programming page $7900...skipping
Programming page $7980...skipping
Programming page $7A00...skipping
Programming page $7A80...skipping
Programming page $7B00...skipping
Programming page $7B80...skipping
Programming page $7C00...skipping
Programming page $7C80...skipping
Programming page $7D00...skipping
Programming page $7D80...skipping
Programming page $7E00...Verifying page @ $7E00
Programming page $7E80...Verifying page @ $7E80
Programming page $7F00...Verifying page @ $7F00
Programming page $7F80...Verifying page @ $7F80
Done!

Code done running.
</code></pre></div></div> </details> <h2 id="conclusion">Conclusion</h2> <p>According to <a href="https://www.reddit.com/r/arduino/comments/10o64v2/comment/j6g53h1/?utm_source=share&amp;utm_medium=web3x&amp;utm_name=web3xcss&amp;utm_term=1&amp;utm_content=share_button" rel="external nofollow noopener" target="_blank">this reddit post</a>, new Nano clones are being shipped with the new bootloader. This procedure would likely work for anyone who would like to update their Nano bootloader if they had an old board. Considering the inexpensive price tag of the Arduino Nano compared to other microcontroller boards, I suspect most people with corrupted bootloaders would opt for a replacement. I am glad I chose the more challenging path of flashing a bootloader which extended the life of my trusty Arduino.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2025-02-17-hardwareISP.bib"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Jason R. Rinehart. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: February 24, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>